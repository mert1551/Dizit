<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DÄ°ZÄ°T - TÃ¼m Filmler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/resim/dizit-favicon.ico" type="image/x-icon">

<meta name="description" content="DÄ°ZÄ°T ile en gÃ¼ncel ve popÃ¼ler filmleri HD kalitede, dublaj ve altyazÄ± seÃ§enekleriyle Ã¼cretsiz izleyin. Ãœyelik gerekmeden hemen izlemeye baÅŸlayÄ±n.">
<meta name="keywords" content="film izle, Ã¼cretsiz film, HD film izle, dizit, tÃ¼rkÃ§e dublaj, altyazÄ±lÄ± film, yeni Ã§Ä±kan filmler">
<meta name="author" content="DÄ°ZÄ°T">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#121212">
<meta property="og:type" content="website">
<meta property="og:title" content="TÃ¼m Filmler | DÄ°ZÄ°T">
<meta property="og:description" content="YÃ¼zlerce HD film reklamsÄ±z ve Ã¼cretsiz olarak DÄ°ZÄ°Tâ€™te. Hemen izlemeye baÅŸla!">
<meta property="og:image" content="https://dizit.onrender.com/resim/dizit-logo-og-1200x630.png">
<meta property="og:url" content="https://dizit.onrender.com/filmler.html">
<meta property="og:site_name" content="DÄ°ZÄ°T">
<meta property="og:locale" content="tr_TR">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "TÃ¼m Filmler | DÄ°ZÄ°T",
  "url": "https://dizit.onrender.com/filmler.html",
  "description": "DÄ°ZÄ°T'te en gÃ¼ncel filmleri Ã¼cretsiz, reklamsÄ±z ve HD kalitede izleyin. Dublaj ve altyazÄ± seÃ§enekleriyle en iyi sinema deneyimi.",
  "inLanguage": "tr",
  "publisher": {
    "@type": "Organization",
    "name": "DÄ°ZÄ°T",
    "url": "https://dizit.onrender.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dizit.onrender.com/resim/dizit-logo-og-1200x630.png",
      "width": 1200,
      "height": 630
    }
  },
  "mainEntity": {
    "@type": "ItemList",
    "name": "Film Listesi",
    "itemListOrder": "http://schema.org/ItemListOrderDescending",
    "numberOfItems": 100,
    "itemListElement": []
  }
}
</script>


</head>
<body>
       <div class="loading-screen" id="loading-screen">
    <div class="curtain-container">
        <div class="curtain-left"></div>
        <div class="curtain-right"></div>
    </div>
    <div class="loading-logo">DÄ°ZÄ°T</div>
    <div class="popcorn-loader">
        <div class="popcorn"></div>
        <div class="popcorn"></div>
        <div class="popcorn"></div>
    </div>
</div>
    <header id="header">
        <a href="/" class="logo">DÄ°ZÄ°T</a>
        <div class="header-right">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Film veya dizi ara...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="burger-menu" id="burger-menu">
                <i class="fas fa-bars"></i>
            </div>
        </div>
        <div class="nav-container" id="nav-container">
            <ul class="nav-links">
                <li><a href="/">Anasayfa</a></li>
                <li><a href="#">Filmler</a></li>
                <li><a href="/diziler">Diziler</a></li>
                <li><a href="/kesfet">KeÅŸfet</a></li>
                <li><a href="/istek-ve-sikayet">Ä°stek ve Åžikayet</a></li>
            </ul>
        </div>
        <div class="profile-wrapper">
            <div class="profile-card" onclick="toggleProfileMenu()">
                <img src="/resim/avatar/user.png" alt="Profile Avatar" class="profile-avatar">
                <span class="profile-username"></span>
                <i class="fas fa-chevron-down profile-arrow"></i>
            </div>
            <div class="profile-dropdown" id="profile-dropdown">
                <ul class="profile-menu">
                    <li><a href="hesabim.html"><i class="fas fa-user"></i> Profilim</a></li>
                    <li><a href="ayarlar.html"><i class="fas fa-cog"></i> Ayarlar</a></li>
                    <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Arama Overlay -->
    <div class="search-overlay" id="search-overlay">
        <div class="search-overlay-header">
            <input type="text" id="search-overlay-input" placeholder="Film veya dizi ara...">
            <button id="close-overlay" class="close-overlay-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="search-results" id="search-results"></div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-modal-content">
            <button class="close-modal" onclick="closeAuthModal()"><i class="fas fa-times"></i></button>
            <div class="auth-tabs">
                <button class="tab-btn active" id="login-tab" onclick="switchTab('login')">GiriÅŸ Yap</button>
                <button class="tab-btn" id="signup-tab" onclick="switchTab('signup')">Ãœye Ol</button>
                <button class="tab-btn" id="forgot-tab" onclick="switchTab('forgot')">Åžifremi Unuttum</button>
            </div>
            <div class="auth-form" id="login-form">
                <h2>GiriÅŸ Yap</h2>
                <form id="login-form-submit" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="login-username">KullanÄ±cÄ± AdÄ±</label>
                        <input type="text" id="login-username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Parola</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <p class="error-message" id="login-error"></p>
                    <button type="submit" class="auth-submit">GiriÅŸ Yap</button>
                    <p class="forgot-link" onclick="switchTab('forgot')">Åžifrenizi mi unuttunuz?</p>
                </form>
            </div>
            <div class="auth-form" id="signup-form" style="display: none;">
                <h2>Ãœye Ol</h2>
                <form id="signup-form-submit" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label for="signup-username">KullanÄ±cÄ± AdÄ±</label>
                        <input type="text" id="signup-username" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">E-posta</label>
                        <input type="email" id="signup-email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Parola</label>
                        <input type="password" id="signup-password" required oninput="validatePassword()">
                        <p class="password-hint" id="password-hint">Parola en az 8 karakter, 1 bÃ¼yÃ¼k harf, 1 kÃ¼Ã§Ã¼k harf ve 1 rakam iÃ§ermelidir.</p>
                    </div>
                    <div class="form-group">
                        <label for="signup-password-confirm">Parola Tekrar</label>
                        <input type="password" id="signup-password-confirm" required>
                    </div>
                    <p class="error-message" id="signup-error"></p>
                    <button type="submit" class="auth-submit">Ãœye Ol</button>
                </form>
            </div>
            <div class="auth-form" id="forgot-form" style="display: none;">
                <h2>Åžifremi Unuttum</h2>
                <form id="forgot-form-submit" onsubmit="handleForgotPassword(event)">
                    <div class="form-group">
                        <label for="forgot-email">E-posta</label>
                        <input type="email" id="forgot-email" required>
                    </div>
                    <p class="error-message" id="forgot-error"></p>
                    <p class="success-message" id="forgot-success"></p>
                    <button type="submit" class="auth-submit">Åžifre SÄ±fÄ±rlama BaÄŸlantÄ±sÄ± GÃ¶nder</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main>
        <div class="home-content">
            <section>
                <h2 class="section-title" id="content-title">TÃ¼m Filmler</h2>
                <div class="movie-grid" id="content-grid"></div>
                <div id="loading-indicator" style="display: none; text-align: center; margin: 20px;">
  <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #ffcc00;"></i> YÃ¼kleniyor...
</div>
<div id="end-of-content-message" style="display: none; text-align: center; color: #aaa; margin: 20px 0; font-style: italic;">
  ðŸŽ‰ TÃ¼m iÃ§erikler gÃ¶sterildi.
</div>

            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>DÄ°ZÄ°T</h3>
                <p>En iyi film ve dizi izleme platformu.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2025 DÄ°ZÄ°T. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // API_URL'yi global olarak tanÄ±mla
        let API_URL = 'http://localhost:3000'; // VarsayÄ±lan deÄŸer, config'den gÃ¼ncellenecek
    
        // API_URL'yi Ã§ekme fonksiyonu
        async function fetchApiUrl() {
            try {
                const response = await fetch('/api/config');
                const data = await response.json();
                API_URL = data.apiUrl;
            } catch (error) {
                console.error('API_URL alÄ±nÄ±rken hata:', error);
                // Hata durumunda varsayÄ±lan URL kullanÄ±lacak
            }
        }
    
        // Oturum YÃ¶netimi
        let isLoggedIn = !!localStorage.getItem('token');
        let currentUser = localStorage.getItem('username') || null;
    
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                isLoggedIn = false;
                currentUser = null;
                updateAuthUI();
                return false;
            }
            try {
                const res = await fetch(`${API_URL}/api/status/1/1/1`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (res.ok) {
                    isLoggedIn = true;
                    currentUser = localStorage.getItem('username');
                    updateAuthUI();
                    return true;
                } else {
                    logout();
                    return false;
                }
            } catch (error) {
                console.error('Auth kontrol hatasÄ±:', error);
                logout();
                return false;
            }
        }
    
        function updateAuthUI() {
    
}
    
        function openAuthModal(type = 'login') {
            const modal = document.getElementById('auth-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            modal.classList.add('active');
            if (type === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                loginTab.classList.remove('active');
                signupTab.classList.add('active');
            }
        }
    
        function closeAuthModal() {
            document.getElementById('auth-modal').classList.remove('active');
            document.getElementById('login-error').textContent = '';
            document.getElementById('signup-error').textContent = '';
            document.getElementById('forgot-error').textContent = '';
            document.getElementById('forgot-success').textContent = '';
            document.getElementById('login-form-submit').reset();
            document.getElementById('signup-form-submit').reset();
            document.getElementById('forgot-form-submit').reset();
            document.getElementById('password-hint').style.color = '#666';
        }
    
        function switchTab(type) {
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            const forgotTab = document.getElementById('forgot-tab');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const forgotForm = document.getElementById('forgot-form');
            const loginError = document.getElementById('login-error');
            const signupError = document.getElementById('signup-error');
            const forgotError = document.getElementById('forgot-error');
            const forgotSuccess = document.getElementById('forgot-success');
    
            loginTab.classList.toggle('active', type === 'login');
            signupTab.classList.toggle('active', type === 'signup');
            forgotTab.classList.toggle('active', type === 'forgot');
            loginForm.style.display = type === 'login' ? 'block' : 'none';
            signupForm.style.display = type === 'signup' ? 'block' : 'none';
            forgotForm.style.display = type === 'forgot' ? 'block' : 'none';
            loginError.textContent = '';
            signupError.textContent = '';
            forgotError.textContent = '';
            forgotSuccess.textContent = '';
            document.getElementById('login-form-submit').reset();
            document.getElementById('signup-form-submit').reset();
            document.getElementById('forgot-form-submit').reset();
            document.getElementById('password-hint').style.color = '#666';
        }
    
        function validatePassword() {
            const password = document.getElementById('signup-password').value;
            const hint = document.getElementById('password-hint');
            const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$/;
            
            if (!strongPasswordRegex.test(password) && password.length > 0) {
                hint.style.color = '#e74c3c';
            } else {
                hint.style.color = '#666';
            }
        }
    
        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            try {
                const res = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                if (res.ok) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('username', data.username);
                    isLoggedIn = true;
                    currentUser = data.username;
                    errorEl.textContent = '';
                    closeAuthModal();
                    updateAuthUI();
                    window.location.reload();
                } else {
                    errorEl.textContent = data.error || 'GiriÅŸ baÅŸarÄ±sÄ±z';
                }
            } catch (error) {
                errorEl.textContent = 'Sunucuyla baÄŸlantÄ± hatasÄ±';
            }
        }
    
        async function handleSignup(event) {
            event.preventDefault();
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const passwordConfirm = document.getElementById('signup-password-confirm').value;
            const errorEl = document.getElementById('signup-error');
            const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$/;
    
            if (!strongPasswordRegex.test(password)) {
                errorEl.textContent = 'Parola en az 8 karakter, 1 bÃ¼yÃ¼k harf, 1 kÃ¼Ã§Ã¼k harf ve 1 rakam iÃ§ermelidir.';
                return;
            }
            if (password !== passwordConfirm) {
                errorEl.textContent = 'Parolalar eÅŸleÅŸmiyor';
                return;
            }
            try {
                const res = await fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                const data = await res.json();
                if (res.ok) {
                    const loginRes = await fetch(`${API_URL}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    const loginData = await loginRes.json();
                    if (loginRes.ok) {
                        localStorage.setItem('token', loginData.token);
                        localStorage.setItem('username', loginData.username);
                        isLoggedIn = true;
                        currentUser = loginData.username;
                        closeAuthModal();
                        updateAuthUI();
                        window.location.reload();
                    } else {
                        errorEl.textContent = loginData.error || 'Otomatik giriÅŸ baÅŸarÄ±sÄ±z';
                    }
                } else {
                    errorEl.textContent = data.error || 'KayÄ±t baÅŸarÄ±sÄ±z';
                }
            } catch (error) {
                errorEl.textContent = 'Sunucuyla baÄŸlantÄ± hatasÄ±';
            }
        }
    
        async function handleForgotPassword(event) {
            event.preventDefault();
            const email = document.getElementById('forgot-email').value;
            const errorEl = document.getElementById('forgot-error');
            const successEl = document.getElementById('forgot-success');
            try {
                const res = await fetch(`${API_URL}/api/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                if (res.ok) {
                    successEl.textContent = 'Åžifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± e-postanÄ±za gÃ¶nderildi.';
                    errorEl.textContent = '';
                } else {
                    errorEl.textContent = data.error || 'Åžifre sÄ±fÄ±rlama baÅŸarÄ±sÄ±z';
                    successEl.textContent = '';
                }
            } catch (error) {
                errorEl.textContent = 'Sunucuyla baÄŸlantÄ± hatasÄ±';
                successEl.textContent = '';
            }
        }
    
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            isLoggedIn = false;
            currentUser = null;
            updateAuthUI();
            updateProfileAvatar();
             window.location.reload();
        }
    
        // Mevcut Fonksiyonlar
        const urlParams = new URLSearchParams(window.location.search);
        const contentType = urlParams.get('type') || 'film';
    
        function displayItems(itemList, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            if (itemList.length === 0) {
                container.innerHTML = '<p>Ä°Ã§erik bulunamadÄ±.</p>';
                return;
            }
            itemList.forEach(item => {
                let languageBadge = '';
                const hasDublaj = item.language.includes("TÃ¼rkÃ§e Dublaj");
                const hasAltyazi = item.language.includes("TÃ¼rkÃ§e AltyazÄ±");
                const isYerli = item.language.includes("Yerli");
                if (isYerli) {
                    languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Yerli</span>';
                } else if (hasDublaj && hasAltyazi) {
                    languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Dublaj <i class="fas fa-closed-captioning"></i> AltyazÄ±</span>';
                } else if (hasDublaj) {
                    languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Dublaj</span>';
                } else if (hasAltyazi) {
                    languageBadge = '<span class="language-badge"><i class="fas fa-closed-captioning"></i> AltyazÄ±</span>';
                }
                const itemCard = document.createElement('div');
                itemCard.className = 'movie-card';
                itemCard.innerHTML = `
                    <div class="poster-wrapper">
                        <img src="${item.poster}" alt="${item.title}" class="movie-poster">
                        ${languageBadge}
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">${item.title}</h3>
                        <div class="movie-meta">
                            <span>${item.year}</span>
                            <div class="imdb-rating">
                                <i class="fas fa-star"></i> ${item.rating}
                            </div>
                        </div>
                    </div>
                `;
                itemCard.onclick = () => window.location.href = `film.html?id=${item.id}`;
                container.appendChild(itemCard);
            });
        }
    
      function appendItems(itemList, containerId) {
    const container = document.getElementById(containerId);

    if (itemList.length === 0 && container.children.length === 0) {
        container.innerHTML = '<p>Ä°Ã§erik bulunamadÄ±.</p>';
        return;
    }

    itemList.forEach(item => {
        let languageBadge = '';
        const hasDublaj = item.language?.includes("TÃ¼rkÃ§e Dublaj");
        const hasAltyazi = item.language?.includes("TÃ¼rkÃ§e AltyazÄ±");
        const isYerli = item.language?.includes("Yerli");

        if (isYerli) {
            languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Yerli</span>';
        } else if (hasDublaj && hasAltyazi) {
            languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Dublaj <i class="fas fa-closed-captioning"></i> AltyazÄ±</span>';
        } else if (hasDublaj) {
            languageBadge = '<span class="language-badge"><img src="resim/flag-tr.png" alt="TR" class="flag-icon"> Dublaj</span>';
        } else if (hasAltyazi) {
            languageBadge = '<span class="language-badge"><i class="fas fa-closed-captioning"></i> AltyazÄ±</span>';
        }

        const itemCard = document.createElement('div');
        itemCard.className = 'movie-card';
        itemCard.innerHTML = `
            <div class="poster-wrapper">
                <img src="${item.poster}" alt="${item.title}" class="movie-poster">
                ${languageBadge}
            </div>
            <div class="movie-info">
                <h3 class="movie-title">${item.title}</h3>
                <div class="movie-meta">
                    <span>${item.year}</span>
                    <div class="imdb-rating">
                        <i class="fas fa-star"></i> ${item.rating}
                    </div>
                </div>
            </div>
        `;
        itemCard.onclick = () => window.location.href = `film.html?id=${item.id}`;
        container.appendChild(itemCard);
    });
}

    
let currentSkip = 0;
const limit = 20;
let isLoading = false;

async function loadMoreSeries() {
    if (isLoading) return;
    isLoading = true;

    const loadingEl = document.getElementById("loading-indicator");
    if (loadingEl) loadingEl.style.display = "block";

    try {
         await new Promise(resolve => setTimeout(resolve, 1000));
        const response = await fetch(`${API_URL}/api/films?skip=${currentSkip}&limit=${limit}`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
            }
        });

        const data = await response.json();
        appendItems(data, "content-grid");

        currentSkip += limit;

       if (data.length < limit) {
    window.removeEventListener("scroll", onScrollLoadMore);

    const endMessage = document.getElementById("end-of-content-message");
    if (endMessage) endMessage.style.display = "block";
}

    } catch (err) {
        console.error("Film yÃ¼klenirken hata oluÅŸtu:", err);
    } finally {
        isLoading = false;
        if (loadingEl) loadingEl.style.display = "none";
    }
}


async function ensureEnoughContent() {
    while (
        document.body.scrollHeight <= window.innerHeight + 100 &&
        !isLoading
    ) {
        await loadMoreSeries();
    }
}


function onScrollLoadMore() {
    const preloadOffset = Math.max(600, window.innerHeight * 0.75);
    if (window.scrollY + window.innerHeight >= document.documentElement.scrollHeight - preloadOffset) {
        loadMoreSeries();
    }
}

// DOMContentLoaded!
document.addEventListener("DOMContentLoaded", async () => {
  document.getElementById("loading-screen")?.classList.remove("hidden");

  await fetchApiUrl();
  await checkAuth();
  await loadMoreSeries();
  await ensureEnoughContent();

  window.addEventListener("scroll", onScrollLoadMore);

  // ðŸŽ¯ Loading ekranÄ±nÄ± kapat
  const loadingScreen = document.getElementById("loading-screen");
  if (loadingScreen) {
    loadingScreen.classList.add("hidden");
    setTimeout(() => loadingScreen.remove(), 800); // animasyonla birlikte kaldÄ±r
  }
});



        function displaySearchResults(results) {
            const searchResults = document.getElementById('search-results');
            searchResults.innerHTML = results.length ? '' : '<p>SonuÃ§ bulunamadÄ±.</p>';
            results.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'search-result-item';
                itemEl.innerHTML = `
                    <img src="${item.poster || 'https://via.placeholder.com/150'}" alt="${item.title}" class="search-result-poster">
                    <div class="search-result-info">
                        <div class="search-result-title">
                            ${item.title || 'Bilinmeyen Ä°Ã§erik'}
                            ${item.title2 ? `<span class="search-result-title2">(${item.title2})</span>` : ''}
                        </div>
                        <div class="search-result-year">${item.year || 'N/A'}</div>
                        <div class="search-result-genres">${Array.isArray(item.genres) ? item.genres.join(', ') : 'N/A'}</div>
                    </div>
                `;
                itemEl.onclick = () => window.location.href = item.type === 'dizi' ? `dizi.html?id=${item.id}` : `film.html?id=${item.id}`;
                searchResults.appendChild(itemEl);
            });
        }
    
        // Event Listeners
        const searchInput = document.getElementById('search-input');
        const searchOverlayInput = document.getElementById('search-overlay-input');
        const searchOverlay = document.getElementById('search-overlay');
        const closeOverlayBtn = document.getElementById('close-overlay');
    
        searchInput.addEventListener('focus', () => {
            searchOverlay.classList.add('active');
            searchOverlayInput.focus();
            searchOverlayInput.value = searchInput.value;
        });
    
        searchOverlayInput.addEventListener('input', async () => {
            const searchTerm = searchOverlayInput.value.trim().toLowerCase();
            if (searchTerm === '') {
                displaySearchResults([]);
                return;
            }
            try {
                const response = await fetch(`${API_URL}/api/search?q=${encodeURIComponent(searchTerm)}`);
                if (!response.ok) {
                    throw new Error('Arama baÅŸarÄ±sÄ±z');
                }
                const results = await response.json();
                displaySearchResults(results);
            } catch (error) {
                console.error('Arama hatasÄ±:', error);
                displaySearchResults([]);
                searchResults.innerHTML = '<p>SonuÃ§ bulunamadÄ±.</p>';
            }
        });
    
        closeOverlayBtn.addEventListener('click', () => {
            searchOverlay.classList.remove('active');
            searchInput.value = '';
            searchOverlayInput.value = '';
        });
    
        const burgerMenu = document.getElementById('burger-menu');
        const navContainer = document.getElementById('nav-container');
        burgerMenu.addEventListener('click', () => {
            navContainer.classList.toggle('active');
        });

        
   async function updateProfileAvatar() {
    const profileAvatar = document.querySelector('.profile-avatar');
    const profileUsername = document.querySelector('.profile-username');
    const profileMenu = document.querySelector('.profile-menu'); // <ul class="profile-menu">

    if (!isLoggedIn) {
        profileAvatar.src = '/resim/avatar/user.png';
        profileUsername.textContent = 'GiriÅŸ Yap';
        return;
    }

    try {
        const response = await fetch(`${API_URL}/api/user-profile?t=${Date.now()}`, {
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        if (!response.ok) {
            if (response.status === 401) {
                localStorage.removeItem('token');
                localStorage.removeItem('username');
                isLoggedIn = false;
                currentUser = null;
                openAuthModal('login');
            }
            throw new Error('KullanÄ±cÄ± verileri alÄ±namadÄ±');
        }

        const user = await response.json();

        // Avatar ve kullanÄ±cÄ± adÄ± gÃ¼ncelle
        profileAvatar.src = user.avatar || '/resim/avatar/user.png';
        profileAvatar.onerror = () => {
            profileAvatar.src = '/resim/avatar/user.png';
        };
        profileUsername.textContent = user.username || 'KullanÄ±cÄ±';
        localStorage.setItem('username', user.username);

        // Daha Ã¶nce eklenmiÅŸ admin panel linki varsa kaldÄ±r
        const existingAdminLink = document.getElementById('admin-panel-link');
        if (existingAdminLink) {
            existingAdminLink.parentElement.remove();
        }

        // EÄŸer kullanÄ±cÄ± adminse, admin panel baÄŸlantÄ±sÄ±nÄ± "Profilim" Ã¶ÄŸesinin Ã¼stÃ¼ne ekle
        if (user.isAdmin && profileMenu) {
            const adminItem = document.createElement('li');
            adminItem.innerHTML = `<a id="admin-panel-link" href="admin/admin-panel.html"><i class="fas fa-tools"></i> Admin Panel</a>`;
            profileMenu.insertBefore(adminItem, profileMenu.firstElementChild);
        }

    } catch (error) {
        console.error('Profil verileri yÃ¼klenemedi:', error);
        profileAvatar.src = '/resim/avatar/user.png';
        profileUsername.textContent = localStorage.getItem('username') || 'GiriÅŸ Yap';
    }
}


async function checkAuth() {
    const token = localStorage.getItem('token');
    if (!token) {
        isLoggedIn = false;
        currentUser = null;
        await updateProfileAvatar();
        return false;
    }
    try {
        const res = await fetch(`${API_URL}/api/verify-token`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (res.ok) {
            const data = await res.json();
            isLoggedIn = true;
            currentUser = data.username;
            localStorage.setItem('username', data.username);
            await updateProfileAvatar();
            return true;
        } else {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            isLoggedIn = false;
            currentUser = null;
            await updateProfileAvatar();
            return false;
        }
    } catch (error) {
        console.error('Token doÄŸrulama hatasÄ±:', error);
        localStorage.removeItem('token');
        localStorage.removeItem('username');
        isLoggedIn = false;
        currentUser = null;
        await updateProfileAvatar();
        return false;
    }
}


function closeProfileMenu() {
    const dropdown = document.getElementById('profile-dropdown');
    dropdown.classList.remove('active');
}

// DÄ±ÅŸ tÄ±klamada menÃ¼yÃ¼ kapat
document.addEventListener('click', (event) => {
    const dropdown = document.getElementById('profile-dropdown');
    const profileCard = document.querySelector('.profile-card');
    if (!dropdown.contains(event.target) && !profileCard.contains(event.target)) {
        closeProfileMenu();
    }
});

document.addEventListener('touchstart', (event) => {
    const dropdown = document.getElementById('profile-dropdown');
    const profileCard = document.querySelector('.profile-card');
    if (!dropdown.contains(event.target) && !profileCard.contains(event.target)) {
        closeProfileMenu();
    }
});
function toggleProfileMenu() {
  const dropdown = document.getElementById('profile-dropdown');
  if (!isLoggedIn) {
    openAuthModal('login');
  } else {
    dropdown.classList.toggle('active');
  }
}

function closeProfileMenu() {
  const dropdown = document.getElementById('profile-dropdown');
  dropdown.classList.remove('active');
}
document.addEventListener('click', (event) => {
  const dropdown = document.getElementById('profile-dropdown');
  const profileCard = document.querySelector('.profile-card');
  if (dropdown && profileCard && !dropdown.contains(event.target) && !profileCard.contains(event.target)) {
    closeProfileMenu();
  }
});




async function updateProfileAvatar() {
  const profileAvatar = document.querySelector('.profile-avatar');
  const profileUsername = document.querySelector('.profile-username');

  if (!isLoggedIn) {
    profileAvatar.src = '/resim/avatar/user.png';
    profileUsername.textContent = 'GiriÅŸ Yap';
    return;
  }

  try {
    const response = await fetch(`${API_URL}/api/user-profile?t=${Date.now()}`, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    });

    if (!response.ok) {
      if (response.status === 401) {
        logout();
        return;
      }
      throw new Error('KullanÄ±cÄ± verileri alÄ±namadÄ±');
    }

    const user = await response.json();
    profileAvatar.src = user.avatar || '/resim/avatar/user.png';
    profileAvatar.onerror = () => {
      profileAvatar.src = '/resim/avatar/user.png';
    };
    profileUsername.textContent = user.username || 'KullanÄ±cÄ±';
    localStorage.setItem('username', user.username);

  } catch (error) {
    console.error('Profil verileri yÃ¼klenemedi:', error);
    profileAvatar.src = '/resim/avatar/user.png';
    profileUsername.textContent = localStorage.getItem('username') || 'GiriÅŸ Yap';
  }
}

  
    </script>
</body>
</html>
